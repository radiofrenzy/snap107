<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SNAP 107 - GHOST SYNC</title>
<link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body {
    background-color: #020210;
    color: #7898FB;
    font-family: 'DotGothic16', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    padding: 0 20px;
    gap: 15px;
    overflow: hidden;
}
#player-widget, #history-widget {
    flex: 1.22;
    height: 380px;
    background: linear-gradient(145deg, #050525, #0a0a35);
    border: 3px solid #1a1a40;
    border-radius: 20px;
    padding: 20px 25px;
    box-shadow: 0 0 50px rgba(0,0,0,0.8);
    display: flex;
    flex-direction: column;
    min-width: 0;
    position: relative;
}
#history-widget { flex: 1; padding: 20px; }
#player-widget .cstrEmbed { flex-grow: 1; width: 100%; height: 100%; }
#player-widget .cstrEmbed iframe { width: 100%; height: 100%; border-radius: 12px; }
.history-header { font-size: 17px; color: #a0baff; margin-bottom: 12px; border-bottom: 1px solid #1a1a40; padding-bottom: 8px; text-transform: uppercase; }
#tracks-inner { flex-grow: 1; overflow-y: auto; font-size: 14.5px; color: #444488; letter-spacing: 0.1px; }
.history-item { margin-bottom: 6px; display: flex; gap: 10px; border-bottom: 1px solid #080828; padding-bottom: 4px; white-space: nowrap; }
.history-time { color: #3a3a6a; min-width: 50px; flex-shrink: 0; }
.history-track { flex-grow: 1; overflow: hidden; text-overflow: clip; }
</style>
</head>
<body>

<!-- LEFT BOX: Caster.fm Embed Player -->
<div id="player-widget">
    <div data-type="newStreamPlayer"
         data-publicToken="68bebccc-3f3d-406f-84e0-10e7cfe152d5"
         data-theme="light"
         data-color="e81e4d"
         data-channelId=""
         data-rendered="false"
         class="cstrEmbed">
        <a href="https://www.caster.fm">Shoutcast Hosting</a>
        <a href="https://www.caster.fm">Stream Hosting</a>
        <a href="https://www.caster.fm">Radio Server Hosting</a>
    </div>
    <script src="//cdn.cloud.caster.fm/widgets/embed.js"></script>
</div>

<!-- RIGHT BOX: 7-DAY RADIO LOG -->
<div id="history-widget">
    <div class="history-header">7-DAY RADIO LOG</div>
    <div id="tracks-inner">INITIALIZING...</div>
</div>

<script>
const SUPABASE_URL = 'https://jjevapkfrxepdfyymtpa.supabase.co';
const SUPABASE_KEY = 'sb_publishable_fu_ULJb3PP0bde3uNFNEYA_rKglhlaw';
const STATION_KEY  = 'SNAP107_SECRET';
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY, {
    global: { headers: { 'x-station-key': STATION_KEY } }
});

// Update the right-hand 7-day log
async function updateHistoryLog() {
    try {
        const { data } = await supabaseClient.from('radio_history').select('*').order('created_at', { ascending: false }).limit(30);
        if (!data || data.length === 0) return;

        document.getElementById('tracks-inner').innerHTML = data.map(item => `
            <div class="history-item">
                <span class="history-time">[${new Date(item.created_at).getHours()}:${String(new Date(item.created_at).getMinutes()).padStart(2,'0')}]</span>
                <span class="history-track">${item.track_title}</span>
            </div>
        `).join('');
    } catch (err) {
        document.getElementById('tracks-inner').innerText = "FAILED TO LOAD LOG";
        console.error(err);
    }
}

// Keep log updated every 5 seconds
setInterval(updateHistoryLog, 5000);
updateHistoryLog();
</script>

</body>
</html>
